# 需求文档

本文档详细描述 NetMate 项目的功能需求。

## 1. 项目概述

### 1.1 项目目标

开发一个跨平台的 **WiFi 管理工具 + 校园网自动登录**（NetMate），核心功能包括：
- **WiFi 自动管理**：WiFi 断开后自动重连，按优先级切换网络
- **校园网认证**：可选的校园网自动登录功能（仅需要认证的 WiFi）
- **网络监控**：实时显示 WiFi 状态、网络延迟、连接质量

**定位变化**：
- **之前**：校园网自动登录工具
- **现在**：完整的 WiFi 管理工具 + 可选的校园网认证

### 1.2 目标用户

- 天津科技大学在校师生（主要用户）
- 需要管理多个 WiFi 网络的用户
- 需要自动切换 WiFi 网络的用户

### 1.3 支持平台

| 平台    | 技术栈           | 优先级         |
| ------- | ---------------- | -------------- |
| Windows | Electron + React | P0             |
| macOS   | Electron + React | P0             |
| Android | React Native     | P1             |
| iOS     | React Native     | P2（暂不开发） |

---

## 2. 功能需求

### 2.1 账户管理

#### 2.1.1 多账户支持

- **描述**：用户可以配置多个校园网账户
- **功能点**：
  - 添加账户（用户名、密码、服务器地址、服务商）
  - 删除账户
  - 切换当前使用的账户
  - 查看账户列表

#### 2.1.2 服务商选择

- **描述**：支持不同运营商的校园网认证
- **选项**：
  - 校园网（campus）
  - 中国移动（cmcc）
  - 中国联通（cucc）
  - 中国电信（ctcc）

#### 2.1.3 服务器地址配置

- **描述**：认证服务器地址可自定义
- **默认值**：`http://10.10.102.50:801`

### 2.2 WiFi 配置

#### 2.2.1 多 WiFi 支持

- **描述**：用户可以配置多个 WiFi 网络
- **功能点**：
  - 添加 WiFi 配置（SSID、密码、是否需要认证）
  - 删除 WiFi 配置
  - 查看 WiFi 配置列表
  - 设置 WiFi 优先级

#### 2.2.2 WiFi 自动重连

- **描述**：WiFi 断开后自动尝试重新连接（核心功能）
- **前提条件**：用户已配置 WiFi 名称和密码
- **工作机制**：
  - WiFi 断开时，应用自动检测到断开事件（检测间隔 1 秒）
  - 自动尝试重新连接到断开的 WiFi
  - 若重连失败，按配置的最大重试次数继续尝试
  - 若达到最大重试次数仍失败，等待 1 秒后切换到下一个优先级的 WiFi
  - 若所有配置的 WiFi 都连接失败，完全停止重连，显示失败提示
- **重要说明**：
  - **与校园网认证完全独立**：WiFi 自动重连不需要配置校园网账户
  - **适用所有 WiFi**：家庭 WiFi、手机热点、校园网 WiFi 均可自动重连
  - **用户可控**：每个 WiFi 配置都有独立的 `autoConnect` 开关
- **显示要求**：
  - 重连过程中显示进度卡片，包含当前尝试的 WiFi 名称和尝试次数（如"正在连接 个人热点 (第 1/3 次)"）
  - 所有 WiFi 连接失败后，显示失败列表，每个 WiFi 一个小卡片，标注"连接超时"

#### 2.2.3 WiFi 认证类型

- **描述**：区分需要校园网认证的 WiFi 和普通 WiFi
- **类型**：
  - **需要认证**：连接后需要向认证服务器发送登录请求
    - 需选择关联的账号（账号已包含服务器地址和服务商信息）
    - 示例：校园网 WiFi（TUST-Student、TUST-Teacher）
  - **无需认证**：家庭 WiFi、手机热点等，连接即可使用
    - 示例：家庭路由器、个人热点、咖啡厅 WiFi
- **重要说明**：
  - 认证类型只影响是否需要校园网登录，不影响 WiFi 自动重连功能
  - 无需认证的 WiFi 也可以配置自动重连

#### 2.2.4 WiFi 优先级

- **描述**：配置 WiFi 的连接优先级
- **用途**：当 WiFi 断开且重连失败时，按优先级顺序尝试切换到其他 WiFi
- **配置方式**：
  - 优先级数值：1-99（数字越小优先级越高）
  - 默认优先级：10
  - 系统按优先级从小到大排序，依次尝试连接
- **使用场景**：
  - 优先级 1：主要使用的校园网 WiFi
  - 优先级 5：备用校园网 WiFi
  - 优先级 10：家庭 WiFi
  - 优先级 20：手机热点
- **界面要求**：
  - WiFi 配置表单中必须包含优先级输入框
  - 优先级为必填项
  - 输入框类型：number，防止滚轮改变值（使用 `onWheel blur` 处理）
  - 提供优先级说明文本：数字越小优先级越高（1-99）
  - 在 WiFi 列表中显示优先级，方便用户查看和对比
- **颜色标识**：
  - 优先级 1-3：红色（#ef4444）- 最高优先级
  - 优先级 4-6：橙色（#f97316）- 高优先级
  - 优先级 7-10：蓝色（#3b82f6）- 中等优先级（默认）
  - 优先级 11-20：绿色（#22c55e）- 低优先级
  - 优先级 21+：灰色（#6b7280）- 最低优先级

### 2.3 登录认证

#### 2.3.1 手动登录

- **描述**：用户点击按钮手动触发登录
- **前提**：已配置至少一个账户

#### 2.3.2 手动登出

- **描述**：用户点击按钮断开当前连接

#### 2.3.3 自动登录

- **描述**：连接到已配置的 WiFi 后自动触发登录
- **条件**：
  - WiFi 的 `requiresAuth` 为 true
  - 已选择当前账户

### 2.4 心跳检测

#### 2.4.1 心跳开关

- **描述**：用户可手动开启/关闭心跳检测功能
- **默认**：关闭
- **开启后**：系统按配置的间隔定时检测网络连通性
- **与 WiFi 关系**：
  - 心跳检测与 WiFi 连接状态绑定
  - 当连接到 WiFi 时，显示心跳检测结果（延迟、连接状态等）
  - 当未连接 WiFi 时，显示友好提示（如"未连接 WiFi，心跳检测已暂停"）
- **与校园网认证关系**：
  - 心跳检测不依赖校园网账户配置
  - 只要连接到 WiFi 就可以进行心跳检测
  - 无需认证的 WiFi（家庭WiFi、热点）也可以进行心跳检测

#### 2.4.2 检测间隔

- **描述**：心跳检测的时间间隔
- **默认值**：30 秒
- **最小值**：5 秒
- **显示要求**：
  - UI 上显示剩余时间倒计时
  - 显示检测间隔（如"每 30 秒检测一次"）
  - 显示最近一次检测的延迟和状态

#### 2.4.3 检测目标

- **描述**：心跳检测使用的测试服务器
- **默认服务器**：
  - 百度（www.baidu.com）
  - 测速网（www.speedtest.cn）
  - 华为云（www.huaweicloud.com）
- **未来功能**：允许用户自定义测试 URL（需在文档中标注为未来功能）

#### 2.4.4 断线重连（校园网认证层）

- **描述**：检测到校园网认证断开后自动尝试重新登录
- **重要说明**：此功能仅针对校园网认证层，与 WiFi 自动重连完全独立
- **前提条件**：
  - WiFi 已连接
  - WiFi 配置的 `requiresAuth` 为 true
  - 已配置关联的校园网账户
  - 心跳检测开启
- **流程**：
  1. 心跳检测发现校园网认证断开（网络不通）
  2. 尝试重新登录校园网（使用指数退避策略）
  3. 若登录成功，恢复正常
  4. 若登录失败，按重试策略继续尝试

#### 2.4.5 重试策略（校园网认证层）

- **描述**：校园网登录失败时的重试机制
- **配置项**：
  - 最大重试次数（默认 3 次）
  - 重试间隔策略：指数退避（1s、2s、4s、8s...）
- **重要说明**：此策略仅用于校园网认证，WiFi 重连使用固定间隔

### 2.5 WiFi 自动重连详细流程

#### 2.5.1 重连触发条件

- **触发条件**：
  1. 检测到 WiFi 断开（检测间隔 1 秒）
  2. 断开的 WiFi 在配置列表中
  3. 该 WiFi 的 `autoConnect` 为 true

#### 2.5.2 重连流程

**阶段 1：单个 WiFi 重连**
1. WiFi 断开后，立即触发重连流程
2. 尝试重新连接到断开的 WiFi
3. 若连接失败，等待固定间隔（默认 2 秒）后重试
4. 重复步骤 2-3，直到达到最大重试次数（默认 3 次，用户可配置）
5. 每次尝试时，向 UI 广播进度：当前 WiFi 名称、当前尝试次数/总次数

**阶段 2：WiFi 优先级切换**
1. 若当前 WiFi 达到最大重试次数仍失败
2. 等待 1 秒
3. 查找下一个优先级的 WiFi（优先级数值更大）
4. 若找到且该 WiFi 的 `autoConnect` 为 true，跳转到"阶段 1"尝试连接
5. 重复步骤 1-4，直到所有配置的 WiFi 都尝试完毕

**阶段 3：所有 WiFi 失败**
1. 若所有配置的 WiFi 都连接失败
2. 完全停止重连流程
3. 向 UI 广播失败事件，包含失败的 WiFi 列表和失败原因
4. UI 显示失败提示卡片：
   - 每个失败的 WiFi 一个小卡片
   - 显示 WiFi 名称、优先级、失败原因（如"连接超时"）
   - 提示用户手动操作

#### 2.5.3 重连配置

- **最大重试次数**：
  - 默认值：3 次
  - 可配置范围：1-10 次
  - 配置位置：设置页面 → 通用设置 → WiFi 重连次数
- **重试间隔**：
  - 固定间隔：2 秒（硬编码，不可配置）
  - 在切换 WiFi 时额外等待 1 秒
- **未来功能**（需在文档中标注）：
  - 所有 WiFi 失败后，用户可配置是否继续循环重试
  - 自定义重试间隔

#### 2.5.4 重连进度显示

- **进度卡片内容**：
  - 当前正在尝试的 WiFi 名称
  - 当前尝试次数 / 总次数（如"第 1/3 次"）
  - 重连状态（如"正在连接..."）
  - 加载动画
- **失败卡片内容**：
  - WiFi 名称
  - 优先级标签（如"优先级 1"）
  - 失败原因（如"连接超时"）
  - 重试按钮（可选，未来功能）

### 2.6 状态显示

#### 2.6.1 启动时 WiFi 检测

- **描述**：应用启动时自动检测当前 WiFi 连接状态
- **功能点**：
  - 检测当前是否已连接 WiFi
  - 若已连接，显示当前连接的 WiFi 名称（SSID）
  - 若未连接，显示"未连接 WiFi"状态
- **触发时机**：应用启动时自动执行
- **显示位置**：运行状态页面
- **优先级**：最高优先级，无论是否配置账户/WiFi，都应首先显示实际 WiFi 连接状态

#### 2.6.2 运行状态页面显示逻辑

运行状态页面应按照以下**优先级顺序**显示信息：

**第一优先级：实际 WiFi 连接状态（必须始终显示）**
- 检测当前是否连接 WiFi
- 若已连接：显示 WiFi 名称（SSID）、信号强度、延迟等信息
- 若未连接：显示"未连接 WiFi"状态
- **此步骤与是否配置账户或 WiFi 配置无关**

**第二优先级：WiFi 配置状态检查**
- 检查当前连接的 WiFi 是否在 WiFi 配置列表中
- 若未配置：显示"该 WiFi 未配置"提示，引导用户配置
- 若已配置：进入下一步检查

**第三优先级：认证需求检查**
- 检查该 WiFi 是否需要校园网认证（`requiresAuth`）
- 若不需要认证：显示"无需认证"状态（如家庭 WiFi、热点等），不显示登录/登出按钮
- 若需要认证：进入下一步检查

**第四优先级：账户配置检查**
- 检查是否配置了关联的账户（`linkedAccountId`）
- 若未配置账户：显示"请配置账户"提示，引导用户添加账户
- 若已配置账户：显示完整的认证状态和登录/登出功能

#### 2.6.3 连接状态

- **描述**：显示当前网络连接状态（仅在需要认证且已配置账户时显示）
- **状态**：
  - 已连接（connected）：已通过校园网认证
  - 未连接（disconnected）：未通过校园网认证
  - 连接中（connecting）：正在尝试认证

#### 2.6.4 网络信息

- **描述**：显示当前网络的详细信息
- **数据来源要求**：所有网络信息必须从系统 API 实时获取，不得使用模拟数据

##### 基础信息（始终显示，若已连接 WiFi）

**WiFi 名称（SSID）**
- 当前连接的 WiFi 网络名称
- 数据来源：系统 WiFi API

**信号强度（Signal Strength）**
- WiFi 信号质量，以百分比显示（0-100%）
- 数据来源：系统 WiFi API
- 颜色分级（支持明暗主题）：

  | 强度范围 | 等级 | 浅色模式 | 深色模式 | 说明 |
  |---------|------|---------|---------|------|
  | 75-100% | 优秀 | #22c55e | #34d399 | 信号极好 |
  | 50-74%  | 良好 | #3b82f6 | #60a5fa | 信号稳定 |
  | 25-49%  | 一般 | #f59e0b | #fbbf24 | 可能不稳定 |
  | 0-24%   | 较差 | #ef4444 | #f87171 | 信号很弱 |

**网络延迟（Ping/Latency）**
- 网络响应时间，单位毫秒（ms）
- 测试目标：优先测试认证服务器延迟，若失败则测试公共 DNS（8.8.8.8）
- 测试频率：每 5 秒更新一次（实时检测）
- 颜色分级（支持明暗主题）：

  | 延迟范围 | 等级 | 浅色模式 | 深色模式 | 说明 |
  |---------|------|---------|---------|------|
  | < 50ms | 优秀 | #22c55e | #34d399 | 适合游戏、视频通话 |
  | 50-99ms | 良好 | #3b82f6 | #60a5fa | 日常使用流畅 |
  | 100-199ms | 一般 | #f59e0b | #fbbf24 | 可能有轻微卡顿 |
  | 200-499ms | 较差 | #f97316 | #fb923c | 明显延迟 |
  | ≥ 500ms | 很差 | #ef4444 | #f87171 | 几乎无法使用 |
  | 超时 | 断开 | #dc2626 | #dc2626 | 无法连接 |

**连接速度（Link Speed）**
- 当前 WiFi 链路速率（如 866 Mbps、1300 Mbps）
- 数据来源：系统 WiFi API
- 说明：这是理论最大速度，实际速度受多种因素影响
- 颜色分级（支持明暗主题）：

  | 速度范围 | 等级 | 浅色模式 | 深色模式 | 说明 |
  |---------|------|---------|---------|------|
  | ≥ 500 Mbps | 极快 | #22c55e | #34d399 | WiFi 6/5GHz 高速 |
  | 200-499 Mbps | 快速 | #3b82f6 | #60a5fa | 5GHz 或 WiFi 5 |
  | 100-199 Mbps | 中速 | #f59e0b | #fbbf24 | 2.4GHz 或 WiFi 4 |
  | 50-99 Mbps | 较慢 | #f97316 | #fb923c | 信号弱或老设备 |
  | < 50 Mbps | 很慢 | #ef4444 | #f87171 | 可能影响使用 |

**频段（Frequency Band）**
- WiFi 工作频段：2.4GHz 或 5GHz
- 数据来源：系统 WiFi API
- 显示格式：
  - 2.4GHz：显示为 "2.4G"
  - 5GHz：显示为 "5G"
- 颜色标识：
  - 5GHz：绿色（#22c55e / #34d399）- 速度快
  - 2.4GHz：蓝色（#3b82f6 / #60a5fa）- 覆盖广

##### 扩展信息（可选显示，按优先级排序）

**IPv4 地址**
- 本机当前 IPv4 地址
- 数据来源：系统网络 API
- 格式：如 192.168.1.100

**IPv6 地址**（如果有）
- 本机当前 IPv6 地址
- 数据来源：系统网络 API
- 显示简写格式

**MAC 地址**（桌面端显示）
- 本机网卡物理地址
- 数据来源：系统网络 API
- 格式：如 AA:BB:CC:DD:EE:FF

**网关地址（Gateway）**
- 路由器 IP 地址
- 数据来源：系统网络 API
- 格式：如 192.168.1.1

**DNS 服务器**
- 当前使用的 DNS 服务器地址
- 数据来源：系统网络 API
- 可能有多个，显示主 DNS

**子网掩码（Subnet Mask）**
- 网络子网掩码
- 数据来源：系统网络 API
- 格式：如 255.255.255.0

**BSSID**（可选）
- 路由器 MAC 地址
- 数据来源：系统 WiFi API
- 用于区分同名 WiFi

**信道（Channel）**（可选）
- WiFi 工作信道
- 数据来源：系统 WiFi API
- 如：信道 6（2.4GHz）、信道 149（5GHz）

**安全类型（Security）**（可选）
- WiFi 加密方式
- 如：WPA2-PSK、WPA3、Open

##### 认证信息（仅在需要认证且已配置账户时显示）

- **当前账户**：使用的认证账户信息
- **认证状态**：已连接/未连接/连接中
- **认证时间**：登录成功的时间
- **在线时长**：已保持连接的时长
- **心跳检测状态**：如果启用了心跳检测，显示检测状态

##### 实现要求

1. **数据实时性**：
   - 所有数据必须从系统 API 实时获取
   - 不允许使用硬编码的模拟数据
   - 延迟数据每 5 秒自动刷新
   - 其他数据在网络状态变化时更新
   - 提供手动刷新按钮，允许用户立即重新测速

2. **手动刷新功能**：
   - 在 WiFi 信息卡片的右上角显示刷新按钮（图标或文字）
   - 点击刷新按钮时：
     - 立即重新获取所有 WiFi 信息（信号强度、连接速度、频段等）
     - 重新测试网络延迟
     - 显示加载状态（旋转动画或 Loading 提示）
     - 防止短时间内重复点击（节流，最小间隔 2 秒）
   - 刷新完成后：
     - 停止加载动画
     - 更新所有数据显示
     - 如果获取失败，显示错误提示

3. **主题适配**：
   - 所有颜色必须提供浅色和深色两套方案
   - 深色模式下颜色应略微调亮，确保可读性
   - 背景色与文字颜色对比度不低于 4.5:1

4. **错误处理**：
   - 如果某项数据获取失败，显示 "获取失败" 或 "不可用"
   - 不应因单项数据失败而阻止其他数据显示
   - 延迟超时时显示 "超时" 而不是错误
   - 如果未连接 WiFi，显示 "未连接" 而不是 0% 或空白

5. **性能优化**：
   - 避免频繁的 API 调用
   - 使用缓存机制（缓存时间 3-5 秒）
   - 异步获取数据，不阻塞 UI 渲染
   - 手动刷新时清除缓存，强制重新获取

##### 显示布局建议

- **桌面端**：使用 2x2 或 2x3 网格布局
- **移动端**：使用垂直列表布局
- **信息密度**：基础信息（SSID、信号、延迟、速度、频段）优先显示，扩展信息可折叠或放在次要位置

### 2.7 日志记录

#### 2.7.1 运行日志

- **描述**：记录应用的运行日志
- **日志级别**：
  - info（信息）
  - success（成功）
  - warn（警告）
  - error（错误）
  - debug（调试）

#### 2.7.2 日志查看

- **描述**：用户可以查看运行日志
- **功能**：
  - 按时间倒序显示
  - 按级别筛选（全部/信息/成功/警告/错误/调试）
  - 显示筛选后的日志数量
  - 清除日志

### 2.8 通知

#### 2.8.1 系统通知

- **描述**：在重要事件发生时推送系统通知
- **事件**：
  - WiFi 断开
  - WiFi 重连成功
  - WiFi 重连失败
  - 校园网登录成功
  - 校园网登录失败
  - 校园网认证断开
  - 校园网自动重连成功

#### 2.8.2 通知开关

- **描述**：用户可开启/关闭通知功能
- **默认**：开启

### 2.9 系统集成

#### 2.9.1 开机自启

- **描述**：应用随系统启动自动运行
- **默认**：关闭
- **实现**：
  - Windows / macOS：使用系统注册表 / LaunchAgents
  - Android：注册 BOOT_COMPLETED 广播

#### 2.9.2 系统托盘（桌面端）

- **描述**：最小化到系统托盘
- **功能**：
  - 托盘图标显示连接状态
  - 右键菜单（显示窗口、登录/登出、退出）

#### 2.9.3 后台服务（移动端）

- **描述**：在后台保持运行
- **实现**：Android Foreground Service

### 2.10 自动更新

#### 2.10.1 桌面端更新

- **描述**：自动检测并下载更新
- **实现**：electron-updater + GitHub Releases

#### 2.10.2 移动端更新

- **描述**：应用内检测更新并下载安装
- **实现**：GitHub Releases API + APK 下载安装

---

## 3. 非功能需求

### 3.1 安全性

- 密码使用系统级加密存储
- 敏感信息不上传到任何服务器
- 日志中不记录密码等敏感信息

### 3.2 性能

- 心跳检测对系统资源占用最小化
- 后台运行时不影响正常使用

### 3.3 可用性

- 界面简洁直观
- 使用图标增强可读性（lucide-react）
- 支持中文界面

### 3.4 可维护性

- 核心业务逻辑跨平台共享
- 模块化设计
- TypeScript 强类型

---

## 4. 用户界面

### 4.1 页面结构

| 页面     | 功能                             |
| -------- | -------------------------------- |
| 运行状态 | 显示连接状态、当前账户、网络信息 |
| 配置设置 | 通用设置、账号管理、WiFi 配置    |
| 运行日志 | 查看运行日志                     |
| 关于     | 应用信息、版本、更新             |

### 4.2 图标使用

使用 lucide-react 图标库，主要图标：

- `Globe` - 运行状态页面标题
- `Settings` - 配置设置页面标题
- `User` - 账户相关
- `Wifi` - WiFi 相关
- `Server` - 服务器地址
- `Heart` - 心跳检测
- `CheckCircle2` - 已连接状态
- `XCircle` - 未连接状态
- `Loader` - 连接中状态
- `AlertCircle` - 警告提示

---

## 5. 验收标准

### 5.1 功能验收

- [ ] 可以添加、删除、切换账户
- [ ] 可以添加、删除 WiFi 配置
- [ ] WiFi 配置支持认证类型切换
- [ ] 手动登录/登出功能正常
- [ ] 启动时自动检测 WiFi 连接状态并显示
- [ ] 心跳检测开关可用
- [ ] 断线自动重连功能正常
- [ ] 未配置账户时显示提示
- [ ] 日志记录和查看功能正常
- [ ] 系统通知功能正常
- [ ] 开机自启功能正常

### 5.2 平台验收

- [ ] Windows 桌面端功能完整
- [ ] macOS 桌面端功能完整
- [ ] Android 移动端功能完整

### 5.3 质量验收

- [ ] 无明显 UI 卡顿
- [ ] 后台运行稳定
- [ ] 密码加密存储
- [ ] 无重大安全漏洞
