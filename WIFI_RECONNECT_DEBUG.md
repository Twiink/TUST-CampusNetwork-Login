# WiFi è‡ªåŠ¨é‡è¿åŠŸèƒ½è°ƒè¯•è®°å½•

## é¡¹ç›®èƒŒæ™¯

NetMate æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„ WiFi ç®¡ç†å·¥å…·ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯ WiFi è‡ªåŠ¨é‡è¿ã€‚æœ¬æ–‡æ¡£è®°å½•äº† WiFi è‡ªåŠ¨é‡è¿åŠŸèƒ½çš„å¼€å‘å’Œè°ƒè¯•è¿‡ç¨‹ã€‚

## å¼€å‘è¿›åº¦

### âœ… å·²å®Œæˆé˜¶æ®µ

#### ç¬¬ä¸€é˜¶æ®µï¼šWiFi é‡è¿é€»è¾‘å¢å¼º
- [x] å®ç°ä¸‰é˜¶æ®µé‡è¿æµç¨‹ï¼š
  1. å•ä¸ªWiFié‡è¿ï¼ˆé‡è¯•Næ¬¡ï¼Œé—´éš”2sï¼‰
  2. ä¼˜å…ˆçº§åˆ‡æ¢ï¼ˆæŒ‰ä¼˜å…ˆçº§å°è¯•å…¶ä»–WiFiï¼Œé—´éš”1sï¼‰
  3. å…¨éƒ¨å¤±è´¥ï¼ˆå¹¿æ’­è¯¦ç»†æ•…éšœåˆ—è¡¨ï¼‰
- [x] å¢å¼ºé‡è¿è¿›åº¦å¹¿æ’­ï¼ˆåŒ…å«å½“å‰WiFiã€å°è¯•æ¬¡æ•°ï¼‰
- [x] å®ç°WiFiæŒ‰ä¼˜å…ˆçº§åˆ‡æ¢é‡è¿é€»è¾‘
- [x] æ›´æ–° main.ts - ä¼ é€’ configManager åˆ° WifiEventListener
- [x] æ·»åŠ  TypeScript ç±»å‹å®šä¹‰ - WiFié‡è¿äº‹ä»¶ç±»å‹

#### ç¬¬äºŒé˜¶æ®µï¼šUI å®ç°
- [x] åˆ›å»º useWifiReconnect hook - ç›‘å¬WiFié‡è¿äº‹ä»¶
- [x] åœ¨ Home.tsx ä¸­æ·»åŠ  WiFi é‡è¿è¿›åº¦å¡ç‰‡
- [x] åœ¨ Home.tsx ä¸­æ·»åŠ æ‰€æœ‰ WiFi è¿æ¥å¤±è´¥æç¤ºå¡ç‰‡
- [x] ä¿®å¤ TypeScript ç¼–è¯‘é”™è¯¯ï¼ˆ7ä¸ªé”™è¯¯ï¼‰
- [x] è¿è¡Œç±»å‹æ£€æŸ¥éªŒè¯æ‰€æœ‰é”™è¯¯å·²ä¿®å¤
- [x] æ„å»ºé¡¹ç›®éªŒè¯ç¼–è¯‘æ— è¯¯

#### ç¬¬ä¸‰é˜¶æ®µï¼šå¿ƒè·³æ£€æµ‹ä¼˜åŒ–
- [x] åˆ†æå½“å‰å¿ƒè·³æ£€æµ‹ä¸WiFiç»‘å®šå…³ç³»
- [x] ç¡®ä¿å¿ƒè·³æ£€æµ‹åªä¸WiFiè¿æ¥çŠ¶æ€ç»‘å®š
- [x] WiFiæœªè¿æ¥æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
- [x] éªŒè¯ç¬¬ä¸‰é˜¶æ®µä»£ç ç¼–è¯‘é€šè¿‡

#### ç¬¬å››é˜¶æ®µï¼šæœºåˆ¶è§£è€¦
- [x] åˆ†æWiFié‡è¿å’Œæ ¡å›­ç½‘é‡è¿æœºåˆ¶
- [x] ç§»é™¤ main.ts ä¸­çš„WiFiåˆ‡æ¢é€»è¾‘
- [x] éªŒè¯è§£è€¦åçš„ä»£ç ç¼–è¯‘é€šè¿‡
- [x] åˆ›å»º RECONNECT_ARCHITECTURE.md æ–‡æ¡£

#### ç¬¬äº”é˜¶æ®µï¼šæ–‡æ¡£æ›´æ–°
- [x] è¯»å–å¹¶åˆ†æç°æœ‰ README.md å†…å®¹
- [x] æ›´æ–° README.md - åæ˜ WiFiç®¡ç†æ ¸å¿ƒåŠŸèƒ½
- [x] æ›´æ–° CLAUDE.md - æ›´æ–°é¡¹ç›®æ¶æ„è¯´æ˜

#### ç¬¬å…­é˜¶æ®µï¼šè°ƒè¯•æ—¥å¿—å¢å¼º
- [x] æ·»åŠ ç»ˆç«¯æ—¥å¿—è¾“å‡ºåŠŸèƒ½ï¼ˆmain.tsï¼‰
- [x] å¢å¼º WiFi äº‹ä»¶ç›‘å¬å™¨çš„è°ƒè¯•æ—¥å¿—

### ğŸ› å½“å‰é—®é¢˜ï¼šWiFi æ–­å¼€æ£€æµ‹å¤±è´¥

#### é—®é¢˜æè¿°
ç”¨æˆ·æµ‹è¯• WiFi æ–­å¼€åœºæ™¯æ—¶ï¼Œå‘ç°ï¼š
1. WiFi æ–­å¼€åæ²¡æœ‰è§¦å‘è‡ªåŠ¨é‡è¿
2. æ²¡æœ‰æ˜¾ç¤ºé‡è¿è¿›åº¦å¡ç‰‡
3. åªæœ‰æ ¡å›­ç½‘å±‚æ£€æµ‹åˆ°æ–­å¼€ï¼ŒWiFi å±‚æ²¡æœ‰ååº”

#### è°ƒè¯•è¿‡ç¨‹

##### ç¬¬ä¸€æ¬¡æµ‹è¯•ï¼ˆåœºæ™¯1ï¼‰
**æ—¥æœŸ**: 2024-01-05 02:19

**ç°è±¡**ï¼š
- WiFi äº‹ä»¶ç›‘å¬å™¨å¯åŠ¨æˆåŠŸ
- WiFi æ–­å¼€æ—¶æ²¡æœ‰çœ‹åˆ° "WiFi å·²æ–­å¼€" æ—¥å¿—
- åªçœ‹åˆ°æ ¡å›­ç½‘å±‚çš„ "æ£€æµ‹åˆ°ç½‘ç»œæ–­å¼€ï¼Œå¯åŠ¨è‡ªåŠ¨é‡è¿"

**åˆæ­¥åˆ†æ**ï¼š
- æ€€ç–‘æ˜¯ WiFi çš„ `autoConnect` å­—æ®µæœªå¯ç”¨
- æˆ–è€… SSID æ£€æµ‹å¤±è´¥

##### ç¬¬äºŒæ¬¡æµ‹è¯•ï¼ˆæ·»åŠ ç»ˆç«¯æ—¥å¿—åï¼‰
**æ—¥æœŸ**: 2024-01-05 02:26

**å…³é”®å‘ç°**ï¼š
```
[02:26:49] [DEBUG] [WiFiæ£€æµ‹] æœªè¿æ¥WiFiï¼Œnetworksetupè¾“å‡º: You are not associated with an AirPort network.
[02:26:51] [SUCCESS] WiFiçŠ¶æ€è·å–æˆåŠŸ {"WiFiå·²è¿æ¥":true,"SSID":"ç¬¨è›‹æ€»æ˜¯æµçœ¼æ³ª",...}
```

**çŸ›ç›¾ç°è±¡**ï¼š
- WiFiäº‹ä»¶ç›‘å¬å™¨ä¸€ç›´æ˜¾ç¤º"æœªè¿æ¥WiFi"
- ä½†å…¶ä»–æœåŠ¡æ˜¾ç¤ºWiFiå·²è¿æ¥åˆ°"ç¬¨è›‹æ€»æ˜¯æµçœ¼æ³ª"

**WiFiæ–­å¼€æ—¶åˆ»ï¼ˆ02:26:59ï¼‰**ï¼š
```
Failed to get macOS WiFi info with system_profiler: Error: Command failed: system_profiler SPAirPortDataType 2>/dev/null
  signal: 'SIGTERM'
[02:27:09] [WARN] æ£€æµ‹åˆ°ç½‘ç»œæ–­å¼€ï¼Œå¯åŠ¨è‡ªåŠ¨é‡è¿
```

**å…³é”®é—®é¢˜**ï¼š
- æ²¡æœ‰çœ‹åˆ° `[INFO] WiFi å·²æ–­å¼€: ç¬¨è›‹æ€»æ˜¯æµçœ¼æ³ª` çš„æ—¥å¿—
- WiFiäº‹ä»¶ç›‘å¬å™¨æ²¡æœ‰æ£€æµ‹åˆ°SSIDå˜åŒ–

#### æ ¹æœ¬åŸå› åˆ†æ

**é—®é¢˜å®šä½**ï¼š`wifi-event-listener.ts` çš„ `getMacOSSsid()` æ–¹æ³•

**ä½¿ç”¨çš„å‘½ä»¤**ï¼š
```bash
networksetup -getairportnetwork en0
```

**å‘½ä»¤è¾“å‡º**ï¼š
```
You are not associated with an AirPort network.
```

**é—®é¢˜åŸå› **ï¼š
1. `networksetup -getairportnetwork en0` å‘½ä»¤æ— æ³•æ­£ç¡®è·å–SSID
2. å¯èƒ½åŸå› ï¼š
   - `en0` ä¸æ˜¯æ­£ç¡®çš„WiFiæ¥å£åç§°ï¼ˆå¯èƒ½æ˜¯ `en1` ç­‰ï¼‰
   - éœ€è¦ç®¡ç†å‘˜æƒé™
   - macOSç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜

**é€»è¾‘åˆ†æ**ï¼š
```typescript
// wifi-event-listener.ts:152-182
private async checkWifiChange(): Promise<void> {
  const currentSsid = await this.getCurrentSsid();  // ä¸€ç›´è¿”å› null

  if (currentSsid !== this.lastSsid) {  // null !== null = falseï¼Œæ¡ä»¶ä¸æ»¡è¶³
    // è¿™é‡Œçš„é€»è¾‘æ°¸è¿œä¸ä¼šæ‰§è¡Œ
    if (prevSsid && currentSsid === null) {
      this.logger.info(`WiFi å·²æ–­å¼€: ${prevSsid}`);
      await this.handleWifiDisconnect(prevSsid);
    }
  }
}
```

**ç»“è®º**ï¼š
- `lastSsid` ä¸€ç›´æ˜¯ `null`ï¼ˆä»å¯åŠ¨å°±æ²¡æœ‰æ­£ç¡®è·å–åˆ°SSIDï¼‰
- å½“WiFiçœŸæ­£æ–­å¼€æ—¶ï¼Œ`currentSsid` è¿˜æ˜¯ `null`
- å› ä¸ºä¸¤ä¸ªå€¼éƒ½æ˜¯ `null`ï¼Œæ‰€ä»¥æ²¡æœ‰è§¦å‘æ–­å¼€æ£€æµ‹

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨ airport å‘½ä»¤ï¼ˆæ¨èï¼‰

macOS å†…ç½®çš„ `airport` å·¥å…·æ›´å¯é ï¼š

```bash
/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
     agrCtlRSSI: -45
     agrExtRSSI: 0
    agrCtlNoise: -90
    agrExtNoise: 0
          state: running
        op mode: station
     lastTxRate: 866
        maxRate: 866
lastAssocStatus: 0
    802.11 auth: open
      link auth: wpa2-psk
          BSSID: xx:xx:xx:xx:xx:xx
           SSID: ç¬¨è›‹æ€»æ˜¯æµçœ¼æ³ª  <-- SSIDåœ¨è¿™é‡Œ
            MCS: 9
        channel: 149
```

### æ–¹æ¡ˆ2ï¼šåŠ¨æ€æ£€æµ‹WiFiæ¥å£

ä¸åŒMacè®¾å¤‡çš„WiFiæ¥å£åç§°å¯èƒ½ä¸åŒï¼š
- MacBook Pro: `en0`
- MacBook Air: `en1`
- Mac mini: `en2`

å¯ä»¥å…ˆæ£€æµ‹æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œæ‰¾åˆ°WiFiæ¥å£ã€‚

### æ–¹æ¡ˆ3ï¼šsystem_profiler ä¼˜åŒ–

è™½ç„¶ `system_profiler` å¾ˆæ…¢ï¼Œä½†å®ƒæ˜¯æœ€å¯é çš„ã€‚å¯ä»¥ï¼š
1. å¢åŠ è¶…æ—¶æ—¶é—´
2. ä½¿ç”¨ç¼“å­˜å‡å°‘è°ƒç”¨é¢‘ç‡
3. åªåœ¨å¿…è¦æ—¶ä½¿ç”¨

## ğŸ“ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **ä¿®æ”¹ getMacOSSsid() æ–¹æ³•**ï¼š
   - å°è¯•ä½¿ç”¨ `airport` å‘½ä»¤
   - è§£æè¾“å‡ºè·å–SSID
   - æ·»åŠ å¤‡ç”¨æ–¹æ¡ˆï¼ˆnetworksetup + airport + system_profilerï¼‰

2. **æµ‹è¯•éªŒè¯**ï¼š
   - éªŒè¯å¯åŠ¨æ—¶èƒ½æ­£ç¡®è·å–SSID
   - æµ‹è¯•WiFiæ–­å¼€èƒ½æ­£ç¡®è§¦å‘é‡è¿
   - æµ‹è¯•ä¸‰é˜¶æ®µé‡è¿æµç¨‹

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å¦‚æœ airport å‘½ä»¤ä¹Ÿæ…¢ï¼Œè€ƒè™‘å¢åŠ æ£€æµ‹é—´éš”
   - æˆ–ä½¿ç”¨äº‹ä»¶ç›‘å¬ä»£æ›¿è½®è¯¢

## ğŸ“‚ ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶
- `apps/desktop/electron/services/wifi-event-listener.ts` - WiFiäº‹ä»¶ç›‘å¬å™¨
- `apps/desktop/electron/main.ts` - ä¸»è¿›ç¨‹ï¼Œåˆå§‹åŒ–æœåŠ¡å’Œæ—¥å¿—
- `apps/desktop/src/hooks/useWifiReconnect.ts` - WiFié‡è¿React Hook
- `apps/desktop/src/pages/Home.tsx` - ä¸»é¡µé¢ï¼Œæ˜¾ç¤ºé‡è¿è¿›åº¦

### ç±»å‹å®šä¹‰
- `apps/desktop/src/types/electron.d.ts` - IPCç±»å‹å®šä¹‰
- `packages/shared/src/types/network.ts` - ç½‘ç»œçŠ¶æ€ç±»å‹

### æ–‡æ¡£
- `README.md` - é¡¹ç›®æ€»è§ˆ
- `CLAUDE.md` - é¡¹ç›®æ¶æ„è¯´æ˜
- `apps/desktop/RECONNECT_ARCHITECTURE.md` - é‡è¿æœºåˆ¶æ¶æ„æ–‡æ¡£
- `WIFI_RECONNECT_DEBUG.md` - æœ¬æ–‡æ¡£

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å½“å‰WiFiæ¥å£
```bash
networksetup -listallhardwareports
```

### ä½¿ç”¨ airport å‘½ä»¤
```bash
/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I
```

### æµ‹è¯• networksetup å‘½ä»¤
```bash
# å°è¯•ä¸åŒçš„æ¥å£
networksetup -getairportnetwork en0
networksetup -getairportnetwork en1
networksetup -getairportnetwork en2
```

### å¯åŠ¨åº”ç”¨å¹¶æŸ¥çœ‹æ—¥å¿—
```bash
pnpm dev:desktop
```

ç»ˆç«¯ä¼šå®æ—¶æ˜¾ç¤ºå½©è‰²æ—¥å¿—ï¼Œæ–¹ä¾¿å¤åˆ¶å’Œåˆ†æã€‚

## ğŸ“Š æ¶æ„è¯´æ˜

### åŒé‡è¿æœºåˆ¶
NetMate æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼š

1. **WiFi è‡ªåŠ¨é‡è¿ï¼ˆç³»ç»Ÿå±‚ï¼‰** - `wifi-event-listener.ts`
   - è§¦å‘æ¡ä»¶ï¼šSSID ä»å­˜åœ¨å˜ä¸º nullï¼ˆç‰©ç†æ–­å¼€ï¼‰
   - ç›‘æµ‹é¢‘ç‡ï¼š1ç§’æ£€æµ‹é—´éš”
   - ä¸‰é˜¶æ®µæµç¨‹ï¼šå•WiFié‡è¯• â†’ ä¼˜å…ˆçº§åˆ‡æ¢ â†’ å…¨éƒ¨å¤±è´¥

2. **æ ¡å›­ç½‘è‡ªåŠ¨é‡è¿ï¼ˆåº”ç”¨å±‚ï¼‰** - `auto-reconnect.ts`
   - è§¦å‘æ¡ä»¶ï¼šå¿ƒè·³æ£€æµ‹å‘ç°è®¤è¯å¤±æ•ˆ
   - é‡è¿ç­–ç•¥ï¼šæŒ‡æ•°é€€é¿ï¼Œæœ€å¤š3æ¬¡
   - å®Œå…¨ç‹¬ç«‹ï¼šä¸è§¦å‘WiFiåˆ‡æ¢

ä¸¤ä¸ªæœºåˆ¶é€šè¿‡çŠ¶æ€å˜åŒ–äº‹ä»¶åä½œï¼Œæ— ç›´æ¥ä¾èµ–ã€‚

### å½“å‰é—®é¢˜å½±å“
ç”±äºWiFiå±‚æ— æ³•æ£€æµ‹åˆ°SSIDå˜åŒ–ï¼Œå¯¼è‡´ï¼š
- âŒ WiFiæ–­å¼€æ—¶ä¸ä¼šè§¦å‘WiFiè‡ªåŠ¨é‡è¿
- âŒ ä¸ä¼šæ˜¾ç¤ºWiFié‡è¿è¿›åº¦
- âŒ ä¸ä¼šæŒ‰ä¼˜å…ˆçº§åˆ‡æ¢WiFi
- âœ… æ ¡å›­ç½‘å±‚ä»èƒ½æ£€æµ‹åˆ°ç½‘ç»œæ–­å¼€å¹¶å°è¯•é‡è¿ï¼ˆä½†æ²¡æœ‰WiFiåˆ‡æ¢ï¼‰

## ğŸ¯ æ€»ç»“

**å½“å‰çŠ¶æ€**ï¼šWiFiè‡ªåŠ¨é‡è¿åŠŸèƒ½çš„UIå’Œé€»è¾‘å·²å®Œæˆï¼Œä½†SSIDæ£€æµ‹å¤±è´¥å¯¼è‡´åŠŸèƒ½æ— æ³•è§¦å‘ã€‚

**ä¸‹ä¸€æ­¥**ï¼šä¿®æ”¹ `getMacOSSsid()` æ–¹æ³•ï¼Œä½¿ç”¨ `airport` å‘½ä»¤æ›¿ä»£ `networksetup`ã€‚

**é¢„æœŸæ•ˆæœ**ï¼šä¿®å¤åï¼ŒWiFiæ–­å¼€æ—¶èƒ½æ­£ç¡®è§¦å‘ä¸‰é˜¶æ®µé‡è¿æµç¨‹ï¼Œå¹¶åœ¨UIä¸Šæ˜¾ç¤ºå®æ—¶è¿›åº¦ã€‚
